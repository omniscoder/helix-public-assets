{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://omniscoder.github.io/Helix/schemas/enzyme/helix_enzyme_session_v1.json",
  "title": "Helix Session (Enzyme) v1",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema", "session_id", "createdUtc", "runs"],
  "properties": {
    "schema": {
      "type": "object",
      "additionalProperties": false,
      "required": ["kind", "version"],
      "properties": {
        "kind": {"const": "helix.session"},
        "version": {"type": "integer", "const": 1}
      }
    },
    "session_id": {"type": "string", "minLength": 1},
    "program_id": {"type": ["string", "null"]},
    "createdUtc": {"type": "string", "format": "date-time"},
    "runs": {"type": "array", "minItems": 1, "items": {"$ref": "#/$defs/run_record"}}
  },
  "$defs": {
    "run_record": {
      "type": "object",
      "additionalProperties": false,
      "required": ["runId", "status", "inputs", "outputs", "backend", "determinismClass", "trust"],
      "properties": {
        "runId": {"type": "string", "minLength": 1},
        "status": {"type": "string", "enum": ["ok", "failed", "gated"]},
        "gateFailures": {"type": "array", "items": {"type": "string", "minLength": 1}},
        "inputs": {
          "type": "object",
          "additionalProperties": false,
          "required": ["config_sha256", "policy_sha256", "ir_sha256"],
          "properties": {
            "config_sha256": {"type": "string", "pattern": "^sha256:[0-9a-fA-F]{64}$"},
            "policy_sha256": {"type": "string", "pattern": "^sha256:[0-9a-fA-F]{64}$"},
            "ir_sha256": {"type": "string", "pattern": "^sha256:[0-9a-fA-F]{64}$"}
          }
        },
        "outputs": {
          "type": "object",
          "additionalProperties": false,
          "required": ["evidence", "report"],
          "properties": {
            "evidence": {"type": "string", "minLength": 1},
            "export": {"type": ["string", "null"]},
            "report": {"type": "string", "minLength": 1}
          }
        },
        "backend": {"type": "object"},
        "determinismClass": {"type": "string", "enum": ["D0", "D1", "D2"]},
        "trust": {"type": "string", "enum": ["core_verified", "core_unverified", "plugin_derived", "viz_derived"]}
      }
    }
  }
}
