{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://omniscoder.github.io/Helix/schemas/enzyme/helix_enzyme_ir_v1.json",
  "title": "Helix Enzyme IR v1",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema", "policy", "model_semantics", "runs"],
  "properties": {
    "schema": {
      "type": "object",
      "additionalProperties": false,
      "required": ["kind", "version"],
      "properties": {
        "kind": {"const": "helix.enzyme.ir"},
        "version": {"type": "integer", "const": 1}
      }
    },
    "program_id": {"type": ["string", "null"]},
    "session_id": {"type": ["string", "null"]},
    "policy": {
      "type": "object",
      "additionalProperties": false,
      "required": ["policyName", "policyVersion", "policyHash"],
      "properties": {
        "policyName": {"type": "string", "minLength": 1},
        "policyVersion": {"type": "string", "minLength": 1},
        "policyHash": {"type": "string", "pattern": "^sha256:[0-9a-fA-F]{64}$"}
      }
    },
    "model_semantics": {
      "type": "object",
      "additionalProperties": false,
      "required": ["scoring_profile", "scorers"],
      "properties": {
        "scoring_profile": {"type": "string", "minLength": 1},
        "scorers": {"type": "array", "items": {"$ref": "#/$defs/scorer"}}
      }
    },
    "runs": {"type": "array", "minItems": 1, "items": {"$ref": "#/$defs/run_ir"}}
  },
  "$defs": {
    "scorer": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "version", "implementation"],
      "properties": {
        "name": {"type": "string", "minLength": 1},
        "version": {"type": "string", "minLength": 1},
        "implementation": {
          "type": "object",
          "additionalProperties": false,
          "required": ["git_sha", "build_id", "backend_kind"],
          "properties": {
            "git_sha": {"type": ["string", "null"]},
            "build_id": {"type": ["string", "null"]},
            "backend_kind": {"type": "string", "minLength": 1}
          }
        },
        "tolerance": {"type": ["number", "null"], "minimum": 0},
        "tolerance_mode": {"type": "string", "enum": ["abs"]},
        "calibration_domain": {"type": ["string", "null"]}
      },
      "allOf": [
        {
          "if": {"properties": {"tolerance": {"type": "number"}}},
          "then": {"required": ["tolerance_mode"]}
        }
      ]
    },
    "run_ir": {
      "type": "object",
      "additionalProperties": true,
      "required": ["run_id", "task_type", "reaction", "environment", "constraints", "search", "scoring_profile"],
      "properties": {
        "run_id": {"type": "string", "minLength": 1},
        "task_type": {"type": "string", "enum": ["single_enzyme", "cascade"]},
        "reaction": {"type": "object"},
        "environment": {"type": "object"},
        "constraints": {"type": "object"},
        "search": {"type": "object"},
        "scoring_profile": {"type": "string", "minLength": 1}
      }
    }
  }
}
